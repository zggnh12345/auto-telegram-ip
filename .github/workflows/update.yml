name: Update Telegram IP Routes (IPv4 & IPv6)

on:
  schedule:
    - cron: '0 1 * * *'  # æ¯å¤© UTC æ—¶é—´ 1:00 è¿è¡Œ
    - cron: '0 0 1 * *'  # æ¯æœˆ1å· UTC æ—¶é—´ 0:00 è¿è¡Œï¼ˆå¼ºåˆ¶æ›´æ–°ï¼‰
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Generate Route Script
      run: |
        chmod +x ./generate-telegram-routes.sh
        ./generate-telegram-routes.sh

    - name: Commit and Push Updated RSC Files
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add routeros-telegram-routes.rsc routeros-telegram-addresslist.rsc
        
        # æ£€æŸ¥æ˜¯å¦æ˜¯æ¯æœˆ1å·çš„å¼ºåˆ¶æ›´æ–°
        if [ "$(date +%d)" = "01" ]; then
          git commit -m "ğŸ¤– æ¯æœˆå¼ºåˆ¶æ›´æ–° Telegram IP è·¯ç”±å’Œåœ°å€åˆ—è¡¨"
          git push
          echo "Monthly forced update completed."
        else
          # æ—¥å¸¸æ›´æ–°ï¼Œåªåœ¨æœ‰å˜åŒ–æ—¶æäº¤
          if ! git diff --cached --quiet; then
            git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–° Telegram IP è·¯ç”±å’Œåœ°å€åˆ—è¡¨"
            git push
            echo "Daily update with changes completed."
          else
            echo "No changes in RSC files. Skipping commit."
          fi
        fi

