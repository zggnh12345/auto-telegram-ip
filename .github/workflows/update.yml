name: Update Telegram IP Routes (IPv4 & IPv6)

on:
  schedule:
    - cron: '0 1 * * *'  # æ¯å¤© UTC æ—¶é—´ 1:00 è¿è¡Œ
  workflow_dispatch:      # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        fetch-depth: 0  # è·å–å®Œæ•´å†å²è®°å½•

    - name: Generate Route Script
      run: |
        chmod +x ./generate-telegram-routes.sh
        ./generate-telegram-routes.sh

    - name: Commit and Push Updated RSC Files
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        
        # æ£€æŸ¥æ–‡ä»¶æ˜¯å¦æœ‰å®é™…å˜åŒ–
        if git status --porcelain | grep -E 'routeros-telegram-(routes|addresslist)\.rsc'; then
          git add routeros-telegram-routes.rsc routeros-telegram-addresslist.rsc
          git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–° Telegram IP è·¯ç”±å’Œåœ°å€åˆ—è¡¨ [skip ci]"
          git push
          echo "Changes detected and pushed successfully."
        else
          echo "No changes in RSC files. Skipping commit."
        fi

