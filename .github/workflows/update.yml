name: Update Telegram IP Routes (IPv4 & IPv6)

on:
  schedule:
    - cron: '0 1 * * *'  # 每天 UTC 时间 1:00 运行
    - cron: '0 0 1 * *'  # 每月1号 UTC 时间 0:00 运行（强制更新）
  workflow_dispatch:      # 允许手动触发

jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v3

    - name: Generate Route Script
      run: |
        chmod +x ./generate-telegram-routes.sh
        ./generate-telegram-routes.sh

    - name: Commit and Push Updated RSC Files
      run: |
        git config user.name "github-actions[bot]"
        git config user.email "github-actions[bot]@users.noreply.github.com"
        git add routeros-telegram-routes.rsc routeros-telegram-addresslist.rsc
        
        # 检查是否是每月1号的强制更新
        if [ "$(date +%d)" = "01" ]; then
          git commit -m "🤖 每月强制更新 Telegram IP 路由和地址列表"
          git push
          echo "Monthly forced update completed."
        else
          # 日常更新，只在有变化时提交
          if ! git diff --cached --quiet; then
            git commit -m "🤖 自动更新 Telegram IP 路由和地址列表"
            git push
            echo "Daily update with changes completed."
          else
            echo "No changes in RSC files. Skipping commit."
          fi
        fi

